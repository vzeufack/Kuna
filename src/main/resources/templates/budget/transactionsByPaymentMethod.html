<!DOCTYPE html>
<html>

<head>
	<title>View budget</title>
	<th:block th:replace="fragments/header :: css"></th:block>
	<link rel="stylesheet" href="/css/main.css"/>
	<script th:inline="javascript">
		$(function () {			
			$("button[id*='delete_transaction_btn']").click(function () {
				var splittedId = $(this).prop('id').split('_');
				var budgetId = splittedId[3];
				var groupId = splittedId[4];
				var categoryId = splittedId[5];
				var transactionId = splittedId[6];
				window.location.href = '/budget/' + budgetId + '/group/' + groupId + '/category/' + categoryId + '/transaction/delete/' + transactionId + '/1';
			});
		});
	</script>
</head>

<body>
	<div class="container">
		<nav class="navbar navbar-expand-lg bg-white border-bottom shadowed">
		  <a class="navbar-brand my-anchor" id="logo" href="/budget/list">Nkap <i class='fas fa-coins'></i></a>
		  <ul class="navbar-nav mr-auto">
		  </ul>
		  <ul class="navbar-nav">
		  	 <li class="nav-item">
		  	 	<a class="my-anchor" th:href="@{/logout}">
		  	 		<i class="fas fa-sign-out-alt"></i>
		  	 	</a>
		  	 </li>
		  </ul>
		</nav>
		
		<nav class="navbar navbar-expand-lg bg-white border-bottom shadowed mt-1">
		    <ul class="navbar-nav mr-auto">
		      <li class="nav-item active">
		      	<h5 class="nav-link" th:text="|${#strings.capitalize(#strings.toLowerCase(budget.month))} ${budget.year}|"></h5>
		      </li>
		    </ul>
		    <ul class="navbar-nav" id="menu">
		      <li class="nav-item active">
		        <a class="nav-link" th:href="@{/budget/view/{budgetId} (budgetId = ${budget.id})}">Plan</a>
		      </li>
		      <li class="nav-item">
		        <a class="nav-link" href="#">Payment methods</a>
		      </li>
		    </ul>
		</nav>
		
		<div class="row mt-3">
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Total income</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalIncome())}|"></h4>
				</div>
			</div>
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Planned</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalPlanned())}|"></h4>
				</div>
			</div>
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Spent</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalSpent())}|"></h4>
				</div>
			</div>
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Balance</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalRemaining())}|"></h4>
				</div>
			</div>
		</div>
		
		<div class="card shadowed mt-3" th:each="paymentMethod : ${paymentMethods}">
		  <div class="card-header group-name">
		  	<!--<div class = "row">-->
			  	<!--<div class="col-sm-6">-->
			  		<a class="my-anchor" th:href="@{/paymentMethod/edit/{paymentMethodId} (paymentMethodId = ${paymentMethod.id})}">
			  	 		<span th:text="|${paymentMethod.name}|"></span>
			  	 	</a>
			  	<!--</div>-->
			  	<!--<div class="col-sm-6 text-right" style="font-weight:bold; font-size:25px">-->
			  		<!--<span style="text-align:right" th:text="|${#numbers.formatCurrency(paymentMethod.getTotal(budget.id))}|"></span>-->
			  	<!--</div>-->
		  	<!--</div>-->
		  </div>
		  <div class="card-body">
				<div th:if="${paymentMethod.paymentType != T(com.kmercoders.balancedApp.model.PaymentType).CREDIT_CARD}">
				    <table  class="table table-hover table-striped">
					  	<tbody>
					      <tr th:each="transaction: ${paymentMethod.transactions}" th:id="|transaction-${transaction.id}|" class='clickable-row'
					  		  th:data-href="@{/budget/{budgetId}/group/{groupId}/category/{categoryId}/transaction/edit/{tranId}/pm (budgetId = ${budget.id}, groupId = ${transaction.category.group.id}, categoryId = ${transaction.category.id}, tranId = ${transaction.id})}">
						      <td th:text="${#temporals.format(transaction.date, 'YYYY-MMM-dd')}"></td>
						      <td th:text="${#numbers.formatCurrency(transaction.amount)}"></td>
						      <td class = "note" th:text="${transaction.note}"></td>
				    	  </tr>
						</tbody>
					</table>
				</div>
				<div th:unless = "${paymentMethod.paymentType != T(com.kmercoders.balancedApp.model.PaymentType).CREDIT_CARD}" style="margin-top:3px">
					
					<div class="card" style="margin-top:3px">
					  <div class="card-header">
					  	 <div class = "row">
						  	<div class="col-sm-6" style="font-weight:bold; font-size:20px">
						  	 	<span>Settled</span>
						  	</div>
						  	<div class="col-sm-6 text-right" style="font-weight:bold; font-size:20px">
						  		<span th:text="|${#numbers.formatCurrency(paymentMethod.getTotal(budget.id, true))}|"></span>
						  	</div>
					  	</div>
					  </div>
					  <div class="card-body">	
							<table  class="table table-striped">
							  	<tbody>				    	
							    	<tr th:each="transaction: ${paymentMethod.transactions}" th:if="${transaction.isSettled == true}" style="cursor:pointer;" th:id="|transaction-${transaction.id}|">
								      
								      <td style="width:1%">
								         <a type="button" th:href="@{/budget/{budgetId}/group/{groupId}/category/{categoryId}/transaction/edit/{tranId}/pm (budgetId = ${budget.id}, groupId = ${transaction.category.group.id}, categoryId = ${transaction.category.id}, tranId = ${transaction.id})}">
								   		 	<i class="fas fa-edit" style="color:cadetblue; margin-right:6px"></i>
									 		 </a>
										</td>
								      <td style="width:15%" th:text="${#temporals.format(transaction.date, 'YYYY-MMM-dd')}"></td>
								      <td style="width:15%" th:text="${#numbers.formatCurrency(transaction.amount)}"></td>
								      <td class = "note" th:text="${transaction.note}"></td>
								      <td style="width:1%">
								      	<a type="button" data-toggle="modal" th:attr="data-target='#delete-transaction'+${transaction.id}">
								 				<i class="fas fa-trash" style="color:orangered"></i>
											</a>
								      </td>
								      
								      <div class="modal fade" th:id="delete-transaction+${transaction.id}" tabindex="-1" role="dialog" 
							          aria-labelledby="deleteTransactionModal" aria-hidden="true">
										  <div class="modal-dialog modal-dialog-centered" role="document">
										    <div class="modal-content">
										      <div class="modal-header">
										        <h5 class="modal-title" id="exampleModalLongTitle">Delete Transaction</h5>
										        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
										          <span aria-hidden="true">&times;</span>
										        </button>
										      </div>
										      <div class="modal-body">
										        Are you sure you want to delete this transaction?
										      </div>
										      <div class="modal-footer">
										        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
										        <button type="button" th:id = "|delete_transaction_btn_${budgetId}_${transaction.category.group.id}_${transaction.category.id}_${transaction.id}|" class="btn btn-danger">Delete</button>
										      </div>
										    </div>
										  </div>
										</div>
							    	</tr>
								</tbody>
							</table>
					  </div>
					</div>
							
					<div class="card" style="margin-top:3px">
					  <div class="card-header">
					  	 <div class = "row">
						  	<div class="col-sm-6" style="font-weight:bold; font-size:20px">
						  	 	<span>Not Settled</span>
						  	</div>
						  	<div class="col-sm-6 text-right" style="font-weight:bold; font-size:20px">
						  		<span th:text="|${#numbers.formatCurrency(paymentMethod.getTotal(budget.id, false))}|"></span>
						  	</div>
					  	</div>
					  </div>
					  <div class="card-body">		
							<table  class="table table-striped">
							  	<tbody>	
							  					    	
							    	<tr th:each="transaction: ${paymentMethod.transactions}" th:if="${transaction.isSettled == false}" style="cursor:pointer;" th:id="|transaction-${transaction.id}|">
								      
								      <td style="width:1%">
								         <a type="button" th:href="@{/budget/{budgetId}/group/{groupId}/category/{categoryId}/transaction/edit/{tranId}/pm (budgetId = ${budget.id}, groupId = ${transaction.category.group.id}, categoryId = ${transaction.category.id}, tranId = ${transaction.id})}">
								   		 	<i class="fas fa-edit" style="color:cadetblue; margin-right:6px"></i>
									 		 </a>
										</td>
								      <td style="width:15%" th:text="${#temporals.format(transaction.date, 'YYYY-MMM-dd')}"></td>
								      <td style="width:15%" th:text="${#numbers.formatCurrency(transaction.amount)}"></td>
								      <td class = "note" th:text="${transaction.note}"></td>
								      <td style="width:1%">
								      	<a type="button" data-toggle="modal" th:attr="data-target='#delete-transaction'+${transaction.id}">
								 				<i class="fas fa-trash" style="color:orangered"></i>
											</a>
								      </td>
								      
								      <div class="modal fade" th:id="delete-transaction+${transaction.id}" tabindex="-1" role="dialog" 
							          aria-labelledby="deleteTransactionModal" aria-hidden="true">
										  <div class="modal-dialog modal-dialog-centered" role="document">
										    <div class="modal-content">
										      <div class="modal-header">
										        <h5 class="modal-title" id="exampleModalLongTitle">Delete Transaction</h5>
										        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
										          <span aria-hidden="true">&times;</span>
										        </button>
										      </div>
										      <div class="modal-body">
										        Are you sure you want to delete this transaction?
										      </div>
										      <div class="modal-footer">
										        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
										        <button type="button" th:id = "|delete_transaction_btn_${budgetId}_${transaction.category.group.id}_${transaction.category.id}_${transaction.id}|" class="btn btn-danger">Delete</button>
										      </div>
										    </div>
										  </div>
										</div>
							    	</tr>
								</tbody>
							</table>
					  </div>
					</div>
					
				</div>
				<!--</div>-->
		  </div>		  
		</div>
	</div>	
	<th:block th:replace="fragments/header :: scripts"></th:block>
	<script src="/js/main.js"></script>
</body>

</html>