<!DOCTYPE html>
<html>

<head>
	<title>View budget</title>
	<th:block th:replace="fragments/header::css"></th:block>
	<link rel="stylesheet" href="/css/main.css"/>
</head>

<body>
	<div class="container">
		<nav class="navbar navbar-expand-lg bg-white border-bottom shadowed">
		  <a class="navbar-brand my-anchor" id="logo" href="/budget/list">Nkap <i class='fas fa-coins'></i></a>
		  <ul class="navbar-nav mr-auto">
		  </ul>
		  <ul class="navbar-nav">
		  	 <li class="nav-item">
		  	 	<a class="my-anchor" th:href="@{/logout}">
		  	 		<i class="fas fa-sign-out-alt"></i>
		  	 	</a>
		  	 </li>
		  </ul>
		</nav>
		
		<nav class="navbar navbar-expand-lg bg-white border-bottom shadowed mt-1">
		    <ul class="navbar-nav mr-auto">
		      <li class="nav-item">
		      	<h5 class="nav-link" th:text="|${#strings.capitalize(#strings.toLowerCase(budget.month))} ${budget.year}|"></h5>
		      </li>
		    </ul>
		    <ul class="navbar-nav" id="menu">
		      <li class="nav-item active">
		        <a class="nav-link" href="#">Plan</a>
		      </li>
		      <li class="nav-item">
		        <a class="nav-link" th:href="@{/budget/transactions_by_payment_method/{budgetId} (budgetId = ${budget.id})}">Payment methods</a>
		      </li>
		    </ul>
		</nav>
		
		<div class="row mt-4">
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Total income</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalIncome())}|"></h4>
				</div>
			</div>
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Planned</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalPlanned())}|"></h4>
				</div>
			</div>
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Spent</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalSpent())}|"></h4>
				</div>
			</div>
			<div class="col-md-3">
				<div class="col-md-12 stat">
					<div>Balance</div>
					<h4 th:text="|${#numbers.formatCurrency(budget.getTotalRemaining())}|"></h4>
				</div>
			</div>
		</div>
		
		<div class="card shadowed mt-4" th:each="group : ${budget.groups}">
		  <div class="card-header">
		  	<a type="button" th:if="${group.name} != 'income'" th:href="@{/budget/{budgetId}/group/edit/{groupId} (budgetId = ${budget.id}, groupId = ${group.id})}">
		  	  <span class="my-anchor group-name" th:text="${#strings.capitalize(#strings.toLowerCase(group.name))}"></span>
		  	</a>
		  	<span class="group-name" th:if="${group.name} == 'income'" th:text="${#strings.capitalize(#strings.toLowerCase(group.name))}"></span>
		  </div>
		  <div class="card-body">
		    <div class="card mb-3 shadowed" th:each="category: ${group.categories}">
		    	<div class="card-header">
		    	  <div class = "row">
			    	  <div class="col-sm-4">
			    	  	  <a id="toggle-bars" data-toggle="collapse" th:href="|#collapse${category.id}|" role="button" aria-controls="|collapse${category.id}|">
			    	  	  	<i class="fa fa-bars my-anchor">&nbsp</i>
			    	  	  </a>
			    	  	  <a type="button" th:href="@{/budget/{budgetId}/group/{groupId}/category/edit/{categoryId} (budgetId = ${budget.id}, groupId = ${group.id}, categoryId = ${category.id})}">
			    	  	  	<span class="my-anchor" th:text="|${#strings.capitalize(#strings.toLowerCase(category.name))}|"></span>
			    	  	  </a>			  
					  </div>
					  <div class="col-sm-4 text-center"><span th:text="|${#numbers.formatCurrency(category.getRemaining)} left|"></span></div>
					  <div class="col-sm-4 text-right"><span th:text="|${#numbers.formatCurrency(category.allocation)}|"></span></div>
				 </div>
				 <div class="progress">
					<div class="progress-bar bg-info" role="progressbar"
					  	th:style="|width: ${category.getPercentLeft()}%|" aria-valuemin="0" aria-valuemax="100"></div>
					</div>
				</div>
				<div class="collapse show" th:id="|collapse${category.id}|">
				  <div class="card-body">
				    <table class="table table-hover table-striped">
					  	<tbody>
					  		<tr th:each="transaction: ${category.transactions}" class='clickable-row'
					  		  th:data-href="@{/budget/{budgetId}/group/{groupId}/category/{categoryId}/transaction/edit/{tranId} (budgetId = ${budget.id}, groupId = ${group.id}, categoryId = ${category.id}, tranId = ${transaction.id})}">
						      <td th:text="${#temporals.format(transaction.date, 'YYYY-MMM-dd')}"></td>
						      <td th:text="${#numbers.formatCurrency(transaction.amount)}"></td>
						      <td class = "note" th:text="${transaction.note}"></td>
					    	</tr>
						</tbody>
					</table>
					<a class="ml-1" type="button"
					   th:href="@{/budget/{budgetId}/group/{groupId}/category/{categoryId}/transaction/create (budgetId = ${budget.id}, groupId = ${group.id}, categoryId = ${category.id})}">
				  	 	Add transaction
				  	</a>
				  </div>
				</div>
			 </div>
			 
			 <div class="row mt-2">
			 	 <div class="col-sm-6 text-left">
					 <a type="button" class="btn btn-outline-primary" th:href="@{/budget/{budgetId}/group/{groupId}/category/create (budgetId = ${budget.id}, groupId = ${group.id})}">
				  	 	<i class="fa fa-plus-square-o"></i> <span>Add category</span>
				  	 </a>
			  	 </div>
		  	 </div>
		  </div>
		</div>
		
		<a type="button" th:href="@{/budget/{budgetId}/group/create (budgetId = ${budget.id})}" class="btn btn-outline-primary btn-lg btn-block shadowed mt-3 mb-3">
			Add group
		</a>
		
		<button type="button" data-toggle="modal" th:attr="data-target='#delete-budget'+${budget.id}" class="btn btn-outline-danger btn-lg btn-block shadowed mt-3 mb-3">
			Detele budget
		</button>
		
		<th:block th:replace="fragments/modals :: delete-budget-modal"></th:block>		
	</div>	
	<th:block th:replace="fragments/header :: scripts"></th:block>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="/js/main.js"></script>
</body>
</html>