<!DOCTYPE html>
<html>

<head>
	<title>Edit category</title>
	<th:block th:replace="fragments/header :: css"></th:block>
</head>

<body>
	<div class="container">
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
		  <a class="navbar-brand" th:href="@{/budget/view/{budgetId} (budgetId = ${budget.id})}" th:text="|${#strings.capitalize(#strings.toLowerCase(budget.month))} ${budget.year}|"></a>
		  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
		    <span class="navbar-toggler-icon"></span>
		  </button>
		  <div class="collapse navbar-collapse" id="navbarText">
		    <ul class="navbar-nav mr-auto">
		      <li class="nav-item active">
		        <a class="nav-link" th:href="@{/budget/view/{budgetId} (budgetId = ${budget.id})}">Plan</a>
		      </li>
		      <li class="nav-item">
		        <a class="nav-link" th:href="@{/budget/transactions_by_payment_method/{budgetId} (budgetId = ${budget.id})}">Payment Methods</a>
		      </li>
		    </ul>
		  </div>
		</nav>

		<div class="col-sm-6 mx-auto" style="margin-top: 100px;">
			<div class="card">
				<div class="card-header">
					<div class="row">
						<div class="h4 col-sm-6" style="text-align: left;">Edit category</div>
						<div class="col-sm-6" style="text-align: right;">
							<a type="button" data-toggle="modal" th:attr="data-target='#delete-category'+${category.id}">
				 				<i class="fas fa-trash" style="color:#d9534f"></i>
							</a>
						</div>
					</div>
				</div>				
				
				<div class="card-body">
					<form method="POST" th:action="@{/budget/{budgetId}/group/{groupId}/category/edit/{categoryId} (budgetId = ${budget.id}, groupId = ${group.id}, categoryId = ${category.id})}" th:object = "${category}">
						<div class="form-group">
							<label for="name">Name</label>
							<input type="text" class="form-control" th:field="*{name}">
							<div class="alert alert-warning" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
						</div>
						<div class="form-group">
							<label for="allocation">Allocation</label>
							<input type="number" step="any" class="form-control" th:field="*{allocation}" placeholder="0.00">
							<div class="alert alert-warning" th:if="${#fields.hasErrors('allocation')}" th:errors="*{allocation}"></div>
						</div>
						<div class="form-group" style="text-align: center; margin-top:40px">
							<a th:href="@{/budget/view/{budgetId} (budgetId = ${budget.id})}" ><button type="button" class="btn btn-secondary col-md-3">Cancel</button></a>
							<button type="submit" class="btn btn-primary col-md-3 ml-auto">Submit</button>
						</div>
					</form>
  				</div>
  				
  				
  				<div class="modal fade" th:id="delete-category+${category.id}" tabindex="-1" role="dialog" aria-labelledby="deleteCategoryModal" aria-hidden="true">
				  <div class="modal-dialog modal-dialog-centered" role="document">
				    <div class="modal-content">
				      <div class="modal-header">
				        <h5 class="modal-title" id="exampleModalLongTitle">Delete Category</h5>
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				          <span aria-hidden="true">&times;</span>
				        </button>
				      </div>
				      <div class="modal-body">
				        Are you sure you want to delete
				        <span style="font-weight:bold" th:text="${category.name}|"/> 
				        category?
				      </div>
				      <div class="modal-footer">
				        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				        <button type="button" th:id = "|delete_category_btn_${budgetId}_${group.id}_${category.id}|" class="btn btn-danger">Delete</button>
				      </div>
				    </div>
				  </div>
				</div>
			</div>
		</div>
	</div>
	<th:block th:replace="fragments/header :: scripts"></th:block>
	<script th:inline="javascript">
		$(function () {			
			$("button[id*='delete_category_btn']").click(function () {
				var splittedId = $(this).prop('id').split('_');
				var budgetId = splittedId[3];
				var groupId = splittedId[4];
				var categoryId = splittedId[5];
				window.location.href = '/budget/' + budgetId + '/group/' + groupId + '/category/delete/' + categoryId;
			});
		});
	</script>
</body>

</html>